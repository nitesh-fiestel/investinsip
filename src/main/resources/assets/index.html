<!DOCTYPE html>
<html>
<head>
    <title>SIP Calculator - Investment Calculator</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9271026697232246"
            crossorigin="anonymous"></script>
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            text-align: left;
        }
        
        .app-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        
        .main-content {
            flex: 1;
            min-width: 0; /* Prevents flex items from overflowing */
        }
        
        .ad-sidebar {
            width: 300px;
            position: sticky;
            top: 20px;
        }
        
        .ad-container {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        @media (max-width: 992px) {
            .app-container {
                flex-direction: column;
            }
            
            .ad-sidebar {
                width: 100%;
                position: static;
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                justify-content: center;
            }
            
            .ad-container {
                width: calc(50% - 10px);
            }
        }
        
        @media (max-width: 576px) {
            .ad-container {
                width: 100%;
            }
        }
        h1 { color: #2c3e50; text-align: center; }
        .row { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px 16px; 
            align-items: end;
        }
        .col { min-width: 220px; }
        /* Header Styles */
        .app-header {
            background: #2c3e50;
            color: white;
            padding: 0.5rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .calculator-section {
            display: none;
        }
        
        .calculator-section.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .nav-link {
            padding: 10px 20px;
            color: #fff;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
            color: white;
        }
        
        .main-nav {
            display: flex;
            gap: 1.5rem;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 0;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: white;
            border-bottom-color: #3498db;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .page-title {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 1.5rem;
        }
        
        .card { background: #f9fbfc; border: 1px solid #e5eef3; border-radius: 8px; padding: 16px; margin: 16px 0; }
        label { display: block; font-size: 13px; color: #34495e; margin-bottom: 4px; }
        input { width: 100%; padding: 8px 10px; border: 1px solid #cfd8dc; border-radius: 6px; font-size: 14px; line-height: 1.2; }
        button { padding: 8px 14px; border: 0; background: #2d7ff9; color: white; border-radius: 6px; cursor: pointer; height: 38px; }
        button:disabled { background: #9bbcf9; cursor: not-allowed; }
        .muted { color: #607d8b; font-size: 12px; }
        .metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 12px; }
        .metric { background: #fff; border: 1px solid #e5eef3; border-radius: 8px; padding: 12px; }
        .metric .label { font-size: 12px; color: #607d8b; }
        .metric .value { font-size: 18px; margin-top: 6px; font-weight: 600; }
        
        /* Pie Chart Styles */
        #profitPieChart {
            width: 100% !important;
            max-width: 400px;
            margin: 0 auto;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Top Header Bar -->
    <header class="app-header">
        <div class="header-content">
            <h1 class="logo">InvestInSIP</h1>
            <nav class="main-nav">
                <a href="#" class="nav-link active" data-tab="sip">SIP Calculator</a>
                <a href="#" class="nav-link" data-tab="swp">SWP Calculator</a>
            </nav>
        </div>
    </header>

    <div class="app-container">
        <main class="main-content">
        <div class="calculator-container">
            <div id="sip-section" class="calculator-section active">
                <h2 class="page-title">SIP Calculator</h2>

    <!-- SIP -->
    <div id="sip" class="card">
        <div class="row">
            <div class="col">
                <label for="initial">Initial investment (₹)</label>
                <input id="initial" type="text" inputmode="numeric" pattern="[0-9,]*" autocomplete="off" value="100000" />
            </div>
            <div class="col">
                <label for="monthly">Monthly investment (₹)</label>
                <input id="monthly" type="text" inputmode="numeric" pattern="[0-9,]*" autocomplete="off" value="10000" />
            </div>
            <div class="col">
                <label for="roi">Annual return rate (% p.a.)</label>
                <input id="roi" type="number" min="0" step="0.1" value="12" />
            </div>
        </div>
        <div class="row">
            <div class="col">
                <label for="inflation">Inflation rate (% p.a.)</label>
                <input id="inflation" type="number" min="0" step="0.1" value="5" />
            </div>
            <div class="col">
                <label for="years">Number of years</label>
                <input id="years" type="number" min="1" step="1" value="20" />
            </div>
            <div class="col" style="display:flex; align-items:flex-end;">
                <button id="calcBtn">Calculate SIP</button>
            </div>
        </div>
        <div class="metrics" id="metrics" style="display:none;">
            <div class="metric">
                <div class="label">Total Invested</div>
                <div class="value" id="investedVal">₹0</div>
            </div>
            <div class="metric">
                <div class="label">Future Value (Nominal)</div>
                <div class="value" id="futureVal">₹0</div>
            </div>
            <div class="metric">
                <div class="label">Future Value (Real)</div>
                <div class="value" id="realVal">₹0</div>
            </div>
        </div>
    </div>

            <div class="card">
                <canvas id="sipChart" height="120"></canvas>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h3>Investment vs Returns</h3>
                <div style="max-width: 500px; margin: 0 auto;">
                    <canvas id="profitPieChart"></canvas>
                </div>
            </div>
        </div>

        <div id="swp-section" class="calculator-section">
            <h2 class="page-title">SWP Calculator</h2>
    <div id="swp" class="card">
        <div class="row">
            <div class="col">
                <label for="swpInitial">Initial corpus (₹)</label>
                <input id="swpInitial" type="text" inputmode="numeric" pattern="[0-9,]*" autocomplete="off" value="2000000" />
            </div>
            <div class="col">
                <label for="swpMonthly">Monthly withdrawal (₹)</label>
                <input id="swpMonthly" type="text" inputmode="numeric" pattern="[0-9,]*" autocomplete="off" value="40000" />
            </div>
            <div class="col">
                <label for="swpRoi">Annual return rate (% p.a.)</label>
                <input id="swpRoi" type="number" min="0" step="0.1" value="10" />
            </div>
        </div>
        <div class="row">
            <div class="col">
                <label for="swpInflation">Inflation rate (% p.a.)</label>
                <input id="swpInflation" type="number" min="0" step="0.1" value="5" />
            </div>
            <div class="col">
                <label for="swpYears">Number of years</label>
                <input id="swpYears" type="number" min="1" step="1" value="25" />
            </div>
            <div class="col" style="display:flex; align-items:flex-end;">
                <button id="swpCalcBtn">Calculate SWP</button>
            </div>
        </div>
        <div class="metrics" id="swpMetrics" style="display:none;">
            <div class="metric">
                <div class="label">Total Withdrawn</div>
                <div class="value" id="swpWithdrawn">₹0</div>
            </div>
            <div class="metric">
                <div class="label">Final Corpus</div>
                <div class="value" id="swpFinalCorpus">₹0</div>
            </div>
            <div class="metric">
                <div class="label">Corpus Exhausted (year)</div>
                <div class="value" id="swpExhausted">—</div>
            </div>
        </div>
    </div>

            <div class="card">
                <canvas id="swpChart" height="120"></canvas>
            </div>
        </div>
    </div>
        <div class="content-section" style="margin-top: 40px; border-top: 1px solid #e9ecef; padding-top: 20px;">
            <article class="info-card">
                <h2>What is a Systematic Investment Plan (SIP)?</h2>
                <p>A <strong>Systematic Investment Plan (SIP)</strong> is a disciplined way of investing in mutual funds. It allows investors to invest a fixed amount regularly—typically monthly or quarterly—into a mutual fund scheme.</p>
                <h3>Key Benefits of SIP</h3>
                <ul>
                    <li><strong>Rupee Cost Averaging:</strong> You buy more units when markets are low and fewer when they are high, averaging out your purchase cost over time.</li>
                    <li><strong>Power of Compounding:</strong> Reinvesting returns allows your money to grow exponentially over long periods.</li>
                    <li><strong>Financial Discipline:</strong> Automating investments ensures you save before you spend.</li>
                </ul>
            </article>

            <article class="info-card" style="margin-top: 30px;">
                <h2>Understanding Systematic Withdrawal Plans (SWP)</h2>
                <p>An <strong>SWP</strong> allows you to withdraw a fixed amount from your mutual fund investments at regular intervals. It is essentially the reverse of a SIP and is ideal for generating a regular income stream, such as during retirement.</p>
                <ul>
                    <li><strong>Regular Income:</strong> Create your own "pension" from your accumulated corpus.</li>
                    <li><strong>Capital Appreciation:</strong> If the withdrawal rate is lower than the fund's growth/return rate, your capital continues to grow even while you withdraw.</li>
                    <li><strong>Tax Efficiency:</strong> Withdrawals are treated as redemptions, attracting capital gains tax only on the profit component of the withdrawn amount.</li>
                </ul>
            </article>

            <article class="info-card" style="margin-top: 30px;">
                <h2>Inflation: The Silent Wealth Eater</h2>
                <p>When planning for long-term goals, it is crucial to account for <strong>inflation</strong>. A corpus that looks huge today might lose significant purchasing power in 20 years.</p>
                <p>The calculators on this page provide two key metrics:</p>
                <ul>
                    <li><strong>Nominal Value:</strong> The raw monetary value of your investment in the future.</li>
                    <li><strong>Real Value:</strong> The inflation-adjusted value, showing what that money could actually buy in today's terms.</li>
                </ul>
            </article>

            <article class="faq-section" style="margin-top: 30px;">
                <h2>Frequently Asked Questions</h2>
                <div class="faq-item">
                    <h4>What is the ideal amount to start a SIP?</h4>
                    <p>You can start a SIP with as little as ₹500 per month. The ideal amount depends on your financial goals. Use the calculator above to reverse-engineer your required monthly investment based on your target corpus.</p>
                </div>
                <div class="faq-item">
                    <h4>Can I stop my SIP anytime?</h4>
                    <p>Yes, SIPs are flexible. You can stop, pause, or increase your SIP amount at any time without penalty (exit loads may apply if you redeem units within a specific period, usually 1 year).</p>
                </div>
                <div class="faq-item">
                    <h4>Is SIP better than a lump sum?</h4>
                    <p>SIP is generally safer for volatile markets as it averages out cost. Lump sum investments are beneficial when markets are low, but timing the market is difficult. SIP eliminates the need for market timing.</p>
                </div>
            </article>
        </div>
        </main>
        
        <aside class="ad-sidebar">
            <!-- AdSense Ad Unit -->
            <div class="ad-container">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-9271026697232246"
                     data-ad-slot="1234567890"
                     data-ad-format="auto"
                     data-full-width-responsive="true">
                </ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            
            <!-- Optional: Add another ad unit below -->
            <div class="ad-container">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-9271026697232246"
                     data-ad-slot="0987654321"
                     data-ad-format="auto"
                     data-full-width-responsive="true">
                </ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </aside>
    </div>

    <script>
        // Format number with commas
        function formatNumberWithCommas(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Handle input formatting with caret preservation
        function handleNumberInput(event) {
            const input = event.target;
            const cursorPos = input.selectionStart || 0;

            // Number of digits to the left of the cursor in the current (possibly formatted) value
            const digitsLeft = input.value.slice(0, cursorPos).replace(/[^0-9]/g, '').length;

            // Raw digits only
            const raw = input.value.replace(/[^0-9]/g, '');

            // Format
            const formatted = raw ? formatNumberWithCommas(parseInt(raw, 10)) : '';

            // Apply formatted value
            if (formatted !== input.value) {
                input.value = formatted;

                // Map the previous digit index to a new caret index in the formatted string
                let seen = 0;
                let newPos = 0;
                for (let i = 0; i < formatted.length; i++) {
                    if (/\d/.test(formatted[i])) {
                        seen++;
                    }
                    newPos = i + 1;
                    if (seen >= digitsLeft) {
                        break;
                    }
                }
                // If there were fewer digits (e.g., deletion), place caret at end
                if (digitsLeft === 0) newPos = 0;
                if (seen < digitsLeft) newPos = formatted.length;
                input.setSelectionRange(newPos, newPos);
            }
        }

        // Parse formatted number back to raw number
        function parseFormattedNumber(str) {
            return parseInt(str.replace(/,/g, '')) || 0;
        }

        // Tab switching functionality
        function showTab(tabId) {
            // Hide all sections
            document.querySelectorAll('.calculator-section').forEach(section => {
                section.classList.remove('active');
            });
            // Show selected section
            document.getElementById(tabId + '-section').classList.add('active');
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.toggle('active', link.getAttribute('data-tab') === tabId);
            });
            
            // Handle chart visibility and calculation
            if (tabId === 'sip') {
                if (chart) {
                    // If chart exists, just update its visibility
                    setTimeout(() => {
                        chart.resize();
                        chart.update();
                    }, 100);
                } else {
                    // If chart doesn't exist, trigger calculation
                    handleCalculate();
                }
            } else if (tabId === 'swp') {
                if (swpChart) {
                    // If chart exists, just update its visibility
                    setTimeout(() => {
                        swpChart.resize();
                        swpChart.update();
                    }, 100);
                } else {
                    // If chart doesn't exist, trigger calculation
                    handleSwpCalculate();
                }
            }
        }
        
        // Initialize input event listeners (apply live formatting only to amount fields)
        document.addEventListener('DOMContentLoaded', function() {
            // Set up tab click handlers
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = e.target.getAttribute('data-tab');
                    showTab(tabId);
                    // Update URL hash
                    window.location.hash = tabId;
                });
            });
            
            // Check URL hash on load
            const initialTab = window.location.hash.substring(1) === 'swp' ? 'swp' : 'sip';
            showTab(initialTab);
            
            const amountInputs = ['initial', 'monthly', 'swpInitial', 'swpMonthly'];
            amountInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', handleNumberInput);
                    // Pre-format default values on load
                    if (input.value) {
                        const raw = input.value.replace(/[^0-9]/g, '');
                        input.value = raw ? formatNumberWithCommas(parseInt(raw, 10)) : '';
                    }
                }
            });
        });

        function fmtINR(x) {
            const abs = Math.abs(x);
            const sign = x < 0 ? '-' : '';
            if (abs >= 1e7) { // Crore
                const v = (abs / 1e7).toFixed(2).replace(/\.00$/, '');
                return sign + v + ' Cr';
            }
            if (abs >= 1e5) { // Lakh
                const v = (abs / 1e5).toFixed(2).replace(/\.00$/, '');
                return sign + v + ' L';
            }
            return sign + new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0 }).format(abs);
        }

        async function fetchSip({ initial, monthly, roi, inflation, years }) {
            const res = await fetch('/api/sip', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ initial, monthly, roi, inflation, years })
            });
            if (!res.ok) throw new Error('SIP API failed: ' + res.status);
            return res.json();
        }

        // SWP
        async function fetchSwp({ initial, monthlyWithdrawal, roi, inflation, years }) {
            const res = await fetch('/api/swp', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ initial, monthlyWithdrawal, roi, inflation, years })
            });
            if (!res.ok) throw new Error('SWP API failed: ' + res.status);
            return res.json();
        }

        let swpChart;
        function renderSwpChart(data) {
            const ctx = document.getElementById('swpChart').getContext('2d');
            if (swpChart) swpChart.destroy();
            swpChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'Corpus (Nominal)',
                            data: data.corpusSeries,
                            borderColor: '#8e44ad',
                            backgroundColor: 'rgba(142,68,173,0.08)',
                            tension: 0.2,
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'Corpus (Real)',
                            data: data.realCorpusSeries,
                            borderColor: '#e67e22',
                            backgroundColor: 'rgba(230,126,34,0.08)',
                            tension: 0.2,
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'Total Withdrawn',
                            data: data.withdrawnSeries,
                            borderColor: '#16a085',
                            backgroundColor: 'rgba(22,160,133,0.08)',
                            tension: 0.2,
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.dataset.label}: ₹${fmtINR(ctx.parsed.y)}`
                            }
                        }
                    },
                    scales: {
                        y: { ticks: { callback: (val) => '₹' + fmtINR(val) } }
                    }
                }
            });
        }

        async function handleSwpCalculate() {
            const initial = parseFormattedNumber(document.getElementById('swpInitial').value);
            const monthlyWithdrawal = parseFormattedNumber(document.getElementById('swpMonthly').value);
            const roi = parseFloat(document.getElementById('swpRoi').value) || 0;
            const inflation = parseFloat(document.getElementById('swpInflation').value) || 0;
            const years = parseInt(document.getElementById('swpYears').value) || 0;
            if (years <= 0) return;
            try {
                const result = await fetchSwp({ initial, monthlyWithdrawal, roi, inflation, years });
                renderSwpChart(result);
                document.getElementById('swpMetrics').style.display = 'grid';
                document.getElementById('swpWithdrawn').innerText = '₹' + fmtINR(result.totalWithdrawn);
                document.getElementById('swpFinalCorpus').innerText = '₹' + fmtINR(result.finalCorpus);
                document.getElementById('swpExhausted').innerText = (result.exhaustedYear || '—');
            } catch (e) {
                alert('Failed to calculate SWP. Please try again.');
                console.error(e);
            }
        }

        let chart, profitPieChart;
        function renderProfitPieChart(invested, returns) {
            const ctx = document.getElementById('profitPieChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (profitPieChart) {
                profitPieChart.destroy();
            }
            
            // Calculate percentages
            const total = invested + returns;
            const investedPercent = Math.round((invested / total) * 100);
            const returnsPercent = 100 - investedPercent;
            
            profitPieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: [
                        `Invested: ₹${fmtINR(invested)} (${investedPercent}%)`,
                        `Returns: ₹${fmtINR(returns)} (${returnsPercent}%)`
                    ],
                    datasets: [{
                        data: [invested, returns],
                        backgroundColor: ['#4e73df', '#1cc88a'],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    return `${label}: ₹${fmtINR(value)}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderChart(data) {
            const ctx = document.getElementById('sipChart').getContext('2d');
            if (chart) chart.destroy();
            
            // Calculate profit
            const invested = data.investedTotal;
            const returns = data.finalNominal - invested;
            
            // Render profit pie chart
            renderProfitPieChart(invested, returns);
            
            // Render main line chart
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'Future Value (Nominal)',
                            data: data.nominalSeries,
                            borderColor: '#2d7ff9',
                            backgroundColor: 'rgba(45,127,249,0.08)',
                            tension: 0.2,
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'Total Invested',
                            data: data.investedSeries,
                            borderColor: '#00b894',
                            backgroundColor: 'rgba(0,184,148,0.08)',
                            tension: 0.2,
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'Future Value (Real)',
                            data: data.realSeries,
                            borderColor: '#e17055',
                            backgroundColor: 'rgba(225,112,85,0.08)',
                            tension: 0.2,
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    stacked: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.dataset.label}: ₹${fmtINR(ctx.parsed.y)}`
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: (val) => '₹' + fmtINR(val)
                            }
                        }
                    }
                }
            });
        }

        async function handleCalculate() {
            const initial = parseFormattedNumber(document.getElementById('initial').value);
            const monthly = parseFormattedNumber(document.getElementById('monthly').value);
            const roi = parseFloat(document.getElementById('roi').value) || 0;
            const inflation = parseFloat(document.getElementById('inflation').value) || 0;
            const years = parseInt(document.getElementById('years').value) || 0;

            if (years <= 0) return;
            try {
                const result = await fetchSip({ initial, monthly, roi, inflation, years });
                renderChart(result);
                document.getElementById('metrics').style.display = 'grid';
                document.getElementById('investedVal').innerText = '₹' + fmtINR(result.investedTotal);
                document.getElementById('futureVal').innerText = '₹' + fmtINR(result.finalNominal);
                document.getElementById('realVal').innerText = '₹' + fmtINR(result.finalReal);
            } catch (e) {
                alert('Failed to calculate SIP. Please try again.');
                console.error(e);
            }
        }

        document.getElementById('calcBtn').addEventListener('click', handleCalculate);
        document.getElementById('swpCalcBtn').addEventListener('click', handleSwpCalculate);

        // Initial render with defaults for active tab
        if (window.location.hash === '#swp') {
            showTab('swp');
        } else {
            showTab('sip');
        }
        
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                // Update active state
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                this.classList.add('active');
                
                // Scroll to section
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 20,
                        behavior: 'smooth'
                    });
                }
            });
        });
    </script>
</body>
</html>
